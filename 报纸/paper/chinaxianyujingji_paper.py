import time
from datetime import datetime
from api_paper import judging_criteria, paper_queue_success, paper_queue_fail, paper_queue_delay, upload_file_by_url, \
    judge_bm_repeat, judging_bm_criteria
import mysql.connector
import requests
from lxml import etree
from DrissionPage import ChromiumPage, ChromiumOptions

co = ChromiumOptions()
co = co.set_argument('--no-sandbox')
co = co.headless()
co.set_paths(local_port=9236)

paper = "中国县域经济报"
headers = {
    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7',
    'Accept-Language': 'zh-CN,zh;q=0.9',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive',
    'Pragma': 'no-cache',
    'Upgrade-Insecure-Requests': '1',
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/127.0.0.0 Safari/537.36',
}

date_dict = {'2024-11-04': 155394, '2024-10-31': 155238, '2024-10-28': 155076, '2024-10-24': 154909,
             '2024-10-21': 154752, '2024-10-17': 154592, '2024-10-14': 154408, '2024-10-10': 154245,
             '2024-09-30': 153958, '2024-09-26': 153767, '2024-09-23': 153607, '2024-09-19': 153441,
             '2024-09-16': 153332, '2024-09-12': 153176, '2024-09-09': 153014, '2024-09-05': 152841,
             '2024-09-02': 152644, '2024-08-29': 152486, '2024-08-26': 152327, '2024-08-22': 152138,
             '2024-08-19': 151982, '2024-08-15': 151824, '2024-08-12': 151663, '2024-08-08': 151502,
             '2024-08-05': 151335, '2024-08-01': 151164, '2024-07-29': 151001, '2024-07-25': 150834,
             '2024-07-22': 150655, '2024-07-18': 150484, '2024-07-15': 150329, '2024-07-11': 150140,
             '2024-07-08': 149961, '2024-07-04': 149802, '2024-07-01': 149655, '2024-06-27': 149491,
             '2024-06-24': 149325, '2024-06-20': 149163, '2024-06-17': 148998, '2024-06-13': 148838,
             '2024-06-10': 148685, '2024-06-06': 148525, '2024-06-03': 148366, '2024-05-30': 148206,
             '2024-05-27': 148033, '2024-05-23': 147869, '2024-05-20': 147704, '2024-05-16': 147532,
             '2024-05-13': 147363, '2024-05-09': 147180, '2024-05-02': 146942, '2024-04-29': 146814,
             '2024-04-25': 146579, '2024-04-22': 146423, '2024-04-18': 146260, '2024-04-15': 146095,
             '2024-04-11': 145944, '2024-04-08': 145783, '2024-04-04': 145671, '2024-04-01': 145511,
             '2024-03-28': 145341, '2024-03-25': 145186, '2024-03-21': 145027, '2024-03-18': 144860,
             '2024-03-14': 144690, '2024-03-11': 144520, '2024-03-07': 144345, '2024-03-04': 144172,
             '2024-02-29': 144007, '2024-02-26': 143811, '2024-02-22': 143654, '2024-02-08': 143972,
             '2024-02-05': 143100, '2024-02-01': 142911, '2024-01-29': 142737, '2024-01-25': 142557,
             '2024-01-22': 142393, '2024-01-18': 142219, '2024-01-15': 142056, '2024-01-11': 141885,
             '2024-01-08': 141720, '2024-01-04': 141552, '2024-01-01': 141398, '2023-12-28': 141246,
             '2023-12-25': 141096, '2023-12-21': 140921, '2023-12-18': 140755, '2023-12-14': 140593,
             '2023-12-11': 140402, '2023-12-07': 140245, '2023-12-04': 140075, '2023-11-30': 139916,
             '2023-11-27': 139738, '2023-11-23': 139588, '2023-11-20': 139367, '2023-11-16': 139192,
             '2023-11-13': 139022, '2023-11-09': 138842, '2023-11-06': 138659, '2023-11-02': 138456,
             '2023-10-30': 138268, '2023-10-26': 138096, '2023-10-23': 137920, '2023-10-19': 137755,
             '2023-10-16': 137552, '2023-10-12': 137381, '2023-10-09': 137207, '2023-10-02': 137030,
             '2023-09-28': 136938, '2023-09-25': 136762, '2023-09-21': 136588, '2023-09-18': 136421,
             '2023-09-14': 136259, '2023-09-11': 136049, '2023-09-07': 135892, '2023-09-04': 135719,
             '2023-08-31': 135547, '2023-08-28': 135375, '2023-08-24': 135570, '2023-08-21': 135018,
             '2023-08-17': 134849, '2023-08-14': 134682, '2023-08-10': 134506, '2023-08-07': 134327,
             '2023-08-03': 134142, '2023-07-31': 133961, '2023-07-27': 133795, '2023-07-24': 133624,
             '2023-07-20': 133442, '2023-07-17': 133281, '2023-07-13': 133103, '2023-07-10': 132919,
             '2023-07-06': 132745, '2023-07-03': 132568, '2023-06-29': 132397, '2023-06-26': 132225,
             '2023-06-22': 132088, '2023-06-19': 131923, '2023-06-15': 131737, '2023-06-12': 131551,
             '2023-06-08': 131370, '2023-06-05': 131194, '2023-06-01': 131024, '2023-05-29': 130852,
             '2023-05-25': 130686, '2023-05-22': 130517, '2023-05-18': 130336, '2023-05-15': 130170,
             '2023-05-11': 129969, '2023-05-08': 129794, '2023-05-01': 129497, '2023-04-27': 129427,
             '2023-04-24': 129254, '2023-04-20': 129074, '2023-04-17': 128878, '2023-04-13': 128654,
             '2023-04-10': 128513, '2023-04-06': 128348, '2023-04-03': 128203, '2023-03-30': 128048,
             '2023-03-27': 127867, '2023-03-23': 127711, '2023-03-20': 127570, '2023-03-16': 127403,
             '2023-03-13': 127222, '2023-03-09': 127055, '2023-03-06': 126872, '2023-03-02': 126692,
             '2023-02-27': 126535, '2023-02-23': 126340, '2023-02-20': 126221, '2023-02-16': 126042,
             '2023-02-13': 125877, '2023-02-09': 125721, '2023-02-06': 125552, '2023-02-02': 125395,
             '2023-01-23': 125070, '2023-01-19': 124944, '2023-01-16': 124768, '2023-01-12': 124610,
             '2023-01-09': 124331, '2023-01-05': 124238, '2023-01-02': 124096, '2022-12-29': 123945,
             '2022-12-26': 123780, '2022-12-22': 123608, '2022-12-19': 123413, '2022-12-15': 123222,
             '2022-12-12': 123029, '2022-12-08': 122864, '2022-12-05': 122886, '2022-12-01': 122545,
             '2022-11-28': 122347, '2022-11-24': 122167, '2022-11-21': 121983, '2022-11-17': 121846,
             '2022-11-14': 121678, '2022-11-10': 121477, '2022-11-07': 121345, '2022-11-03': 121172,
             '2022-10-31': 120966, '2022-10-27': 120782, '2022-10-24': 120581, '2022-10-20': 120415,
             '2022-10-17': 120219, '2022-10-13': 120041, '2022-10-10': 119866, '2022-10-03': 119638,
             '2022-09-29': 119556, '2022-09-26': 119350, '2022-09-22': 119175, '2022-09-19': 119008,
             '2022-09-15': 118834, '2022-09-12': 118628, '2022-09-08': 118537, '2022-09-05': 118370,
             '2022-09-01': 118165, '2022-08-29': 117972, '2022-08-25': 117805, '2022-08-22': 117603,
             '2022-08-18': 117423, '2022-08-15': 117254, '2022-08-11': 117086, '2022-08-08': 116887,
             '2022-08-04': 116733, '2022-08-01': 116536, '2022-07-28': 116365, '2022-07-25': 116172,
             '2022-07-21': 116000, '2022-07-18': 115838, '2022-07-14': 115655, '2022-07-11': 115479,
             '2022-07-07': 115285, '2022-07-04': 115103, '2022-06-30': 114924, '2022-06-27': 114728,
             '2022-06-23': 114807, '2022-06-20': 114372, '2022-06-16': 114201, '2022-06-13': 114014,
             '2022-06-09': 113794, '2022-06-06': 113650, '2022-06-02': 113495, '2022-05-30': 113324,
             '2022-05-26': 113168, '2022-05-23': 112988, '2022-05-19': 112770, '2022-05-16': 112768,
             '2022-05-12': 112769, '2022-05-09': 112581, '2022-05-02': 112014, '2022-04-28': 111853,
             '2022-04-25': 111633, '2022-04-21': 111481, '2022-04-18': 111291, '2022-04-14': 111119,
             '2022-04-11': 110909, '2022-04-07': 110728, '2022-04-04': 110570, '2022-03-31': 110425,
             '2022-03-28': 110254, '2022-03-24': 110078, '2022-03-21': 109881, '2022-03-17': 109689,
             '2022-03-14': 109472, '2022-03-10': 109205, '2022-03-07': 108979, '2022-03-03': 108788,
             '2022-02-28': 108616, '2022-02-24': 108457, '2022-02-21': 108286, '2022-02-17': 108115,
             '2022-02-14': 107944, '2022-02-10': 107841, '2022-01-31': 107614, '2022-01-27': 107308,
             '2022-01-24': 107146, '2022-01-20': 106957, '2022-01-17': 106773, '2022-01-13': 106593,
             '2022-01-10': 106404, '2022-01-06': 106180, '2022-01-03': 106542, '2021-12-30': 105871,
             '2021-12-27': 105680, '2021-12-23': 105504, '2021-12-20': 105317, '2021-12-16': 105158,
             '2021-12-13': 104985, '2021-12-09': 104818, '2021-12-06': 104624, '2021-12-02': 104459,
             '2021-11-29': 104247, '2021-11-25': 104088, '2021-11-22': 103898, '2021-11-18': 103739,
             '2021-11-15': 103566, '2021-11-11': 103401, '2021-11-08': 103225, '2021-11-04': 103067,
             '2021-11-01': 102837, '2021-10-28': 102676, '2021-10-25': 102487, '2021-10-21': 102332,
             '2021-10-18': 102160, '2021-10-14': 101995, '2021-10-11': 101880, '2021-09-30': 101524,
             '2021-09-27': 101158, '2021-09-23': 100941, '2021-09-22': 100882, '2021-09-16': 100654,
             '2021-09-13': 100491, '2021-09-09': 100315, '2021-09-06': 100134, '2021-09-02': 99971, '2021-08-30': 99770,
             '2021-08-26': 99610, '2021-08-23': 99435, '2021-08-19': 99272, '2021-08-16': 99100, '2021-08-12': 98932,
             '2021-08-09': 98754, '2021-08-05': 98587, '2021-08-02': 98411, '2021-07-29': 98240, '2021-07-26': 98067,
             '2021-07-22': 97905, '2021-07-19': 97738, '2021-07-15': 97564, '2021-07-12': 97383, '2021-07-08': 97216,
             '2021-07-05': 97048, '2021-07-02': 96927, '2021-07-01': 96864, '2021-06-28': 96641, '2021-06-24': 96454,
             '2021-06-21': 96290, '2021-06-17': 96121, '2021-06-14': 95852, '2021-06-10': 95671, '2021-06-07': 105778,
             '2021-06-03': 95299, '2021-05-31': 95126, '2021-05-27': 94953, '2021-05-24': 94764, '2021-05-20': 94586,
             '2021-05-17': 94585, '2021-05-13': 94178, '2021-05-10': 93996, '2021-05-03': 93815, '2021-04-29': 93608,
             '2021-04-26': 93421, '2021-04-22': 93228, '2021-04-19': 93109, '2021-04-15': 92862, '2021-04-12': 92635,
             '2021-04-08': 92471, '2021-04-05': 92358, '2021-04-01': 92176, '2021-03-29': 91954, '2021-03-25': 91767,
             '2021-03-22': 91575, '2021-03-18': 91339, '2021-03-15': 91155, '2021-03-11': 90910, '2021-03-08': 90733,
             '2021-03-04': 90550, '2021-03-01': 90365, '2021-02-25': 90195, '2021-02-22': 90023, '2021-02-18': 89798,
             '2021-02-08': 89533, '2021-02-04': 89353, '2021-02-01': 89172, '2021-01-28': 88986, '2021-01-25': 88809,
             '2021-01-21': 88644, '2021-01-18': 88475, '2021-01-14': 88296, '2021-01-11': 88110, '2021-01-07': 87941,
             '2021-01-04': 87718, '2020-12-31': 87582, '2020-12-28': 87362, '2020-12-24': 87177, '2020-12-21': 86967,
             '2020-12-17': 86780, '2020-12-14': 86594, '2020-12-10': 86417, '2020-12-07': 86207, '2020-12-03': 86023,
             '2020-11-30': 85803, '2020-11-26': 85612, '2020-11-23': 85358, '2020-11-19': 85182, '2020-11-16': 84992,
             '2020-11-12': 84804, '2020-11-09': 84686, '2020-11-05': 84404, '2020-11-02': 84178, '2020-10-29': 83958,
             '2020-10-26': 83554, '2020-10-22': 83372, '2020-10-19': 83185, '2020-10-15': 83003, '2020-10-12': 82803,
             '2020-10-01': 82517, '2020-09-28': 82312, '2020-09-24': 81942, '2020-09-21': 81754, '2020-09-17': 81564,
             '2020-09-14': 81381, '2020-09-10': 81193, '2020-09-07': 80986, '2020-09-03': 80820, '2020-08-31': 80624,
             '2020-08-27': 80696, '2020-08-24': 80237, '2020-08-20': 80033, '2020-08-17': 79848, '2020-08-13': 79676,
             '2020-08-10': 79495, '2020-08-06': 79326, '2020-08-03': 79113, '2020-07-30': 78962, '2020-07-27': 78750,
             '2020-07-23': 78552, '2020-07-20': 78359, '2020-07-16': 78195, '2020-07-13': 78003, '2020-07-09': 77834,
             '2020-07-06': 77648, '2020-07-02': 77475, '2020-06-29': 77302, '2020-06-25': 77364, '2020-06-22': 77020,
             '2020-06-18': 76637, '2020-06-15': 76419, '2020-06-11': 76238, '2020-06-08': 76066, '2020-06-04': 75900,
             '2020-06-01': 75720, '2020-05-28': 75527, '2020-05-25': 75355, '2020-05-21': 75154, '2020-05-18': 74978,
             '2020-05-14': 74790, '2020-05-11': 74622, '2020-05-07': 74425, '2020-04-30': 74205, '2020-04-27': 74025,
             '2020-04-23': 73838, '2020-04-20': 73663, '2020-04-16': 73494, '2020-04-13': 73324, '2020-04-09': 73155,
             '2020-04-06': 73036, '2020-04-02': 72848, '2020-03-30': 72671, '2020-03-26': 72474, '2020-03-23': 72291,
             '2020-03-19': 72115, '2020-03-16': 71935, '2020-03-12': 71753, '2020-03-09': 71562, '2020-03-05': 71384,
             '2020-03-02': 71180, '2020-02-27': 70991, '2020-02-24': 70810, '2020-02-20': 70615, '2020-02-17': 70457,
             '2020-02-13': 70274, '2020-01-23': 69518, '2020-01-20': 69332, '2020-01-16': 69155, '2020-01-13': 68980,
             '2020-01-09': 68798, '2020-01-06': 68615, '2020-01-02': 68409, '2019-12-30': 68237, '2019-12-26': 68081,
             '2019-12-23': 67873, '2019-12-19': 67695, '2019-12-16': 67469, '2019-12-12': 67383, '2019-12-09': 67187,
             '2019-12-05': 66857, '2019-12-02': 66517, '2019-11-28': 66245, '2019-11-25': 65960, '2019-11-21': 65753,
             '2019-11-18': 65510, '2019-11-14': 65289, '2019-11-11': 65090, '2019-11-07': 64922, '2019-11-04': 64713,
             '2019-10-31': 64540, '2019-10-28': 64340, '2019-10-24': 64147, '2019-10-21': 63929, '2019-10-17': 63766,
             '2019-10-14': 63584, '2019-10-10': 63395, '2019-09-30': 63044, '2019-09-26': 62864, '2019-09-23': 62676,
             '2019-09-19': 62516, '2019-09-16': 62312, '2019-09-12': 62199, '2019-09-09': 61997, '2019-09-05': 61821,
             '2019-09-02': 61621, '2019-08-29': 61453, '2019-08-26': 61250, '2019-08-22': 61090, '2019-08-19': 60896,
             '2019-08-15': 60715, '2019-08-12': 60536, '2019-08-08': 60365, '2019-08-05': 60196, '2019-08-01': 59992,
             '2019-07-29': 59820, '2019-07-25': 59660, '2019-07-22': 59471, '2019-07-18': 59296, '2019-07-15': 59087,
             '2019-07-11': 58923, '2019-07-08': 58742, '2019-07-04': 58558, '2019-07-01': 58355, '2019-06-27': 58176,
             '2019-06-24': 57975, '2019-06-20': 57801, '2019-06-17': 57507, '2019-06-13': 57415, '2019-06-10': 57212,
             '2019-06-06': 57073, '2019-06-03': 56865, '2019-05-30': 56704, '2019-05-27': 56491, '2019-05-23': 56290,
             '2019-05-20': 56081, '2019-05-16': 55905, '2019-05-13': 55712, '2019-05-09': 55522, '2019-05-02': 55255,
             '2019-04-29': 55046, '2019-04-25': 54803, '2019-04-22': 54595, '2019-04-18': 54388, '2019-04-15': 54182,
             '2019-04-11': 53996, '2019-04-08': 53782, '2019-04-04': 53668, '2019-04-01': 53425, '2019-03-28': 53240,
             '2019-03-25': 53037, '2019-03-21': 52859, '2019-03-18': 52638, '2019-03-14': 52453, '2019-03-11': 52235,
             '2019-03-07': 52061, '2019-03-04': 51849, '2019-02-28': 51663, '2019-02-25': 51440, '2019-02-21': 51244,
             '2019-02-18': 51021, '2019-02-14': 50842, '2019-02-04': 50522, '2019-01-31': 50363, '2019-01-28': 50159,
             '2019-01-24': 49939, '2019-01-21': 49720, '2019-01-17': 49556, '2019-01-14': 49347, '2019-01-10': 49145,
             '2019-01-07': 48935, '2019-01-03': 48744, '2018-12-31': 48530, '2018-12-27': 48395, '2018-12-24': 48175,
             '2018-12-20': 47979, '2018-12-17': 47761, '2018-12-13': 47322, '2018-12-10': 47006, '2018-12-06': 46806,
             '2018-12-03': 46610, '2018-11-29': 46415, '2018-11-26': 46213, '2018-11-21': 46031, '2018-11-19': 45782,
             '2018-11-15': 45583, '2018-11-12': 45364, '2018-11-08': 45167, '2018-11-05': 45033, '2018-11-01': 44759,
             '2018-10-29': 44540, '2018-10-25': 44348, '2018-10-22': 44151, '2018-10-18': 43929, '2018-10-15': 43746,
             '2018-10-11': 43556, '2018-10-01': 43365, '2018-09-27': 43028, '2018-09-24': 42858, '2018-09-20': 42665,
             '2018-09-17': 42452, '2018-09-13': 42258, '2018-09-10': 42043, '2018-09-06': 41878, '2018-09-03': 41655,
             '2018-08-30': 41460, '2018-08-27': 41250, '2018-08-23': 41043, '2018-08-20': 40841, '2018-08-16': 40639,
             '2018-08-13': 40440, '2018-08-09': 40280, '2018-08-06': 40092, '2018-08-02': 39915, '2018-07-30': 39727,
             '2018-07-26': 39561, '2018-07-23': 39304, '2018-07-19': 39173, '2018-07-16': 39038, '2018-07-12': 38763,
             '2018-07-09': 38546, '2018-07-05': 38367, '2018-07-02': 38171, '2018-06-28': 37992, '2018-06-25': 37774,
             '2018-06-21': 37602, '2018-06-18': 37486, '2018-06-14': 37275, '2018-06-11': 37039, '2018-06-07': 36846,
             '2018-06-04': 36658, '2018-05-31': 35944, '2018-05-28': 35696, '2018-05-25': 35695, '2018-05-24': 35492,
             '2018-05-21': 35295, '2018-05-17': 35138, '2018-05-14': 34920, '2018-05-10': 34765, '2018-05-07': 34568,
             '2018-05-03': 34396, '2018-05-02': 34317, '2018-04-26': 34064, '2018-04-23': 33893, '2018-04-19': 33680,
             '2018-04-16': 33454, '2018-04-12': 33223, '2018-04-09': 33018, '2018-04-05': 32966, '2018-04-02': 32730,
             '2018-03-29': 32538, '2018-03-26': 32334, '2018-03-22': 32159, '2018-03-19': 31984, '2018-03-15': 31803,
             '2018-03-12': 31556, '2018-03-08': 31398, '2018-03-05': 31208, '2018-03-01': 31036, '2018-02-15': 30546,
             '2018-02-12': 30403, '2018-02-08': 30145, '2018-02-05': 29961, '2018-02-01': 29794, '2018-01-29': 29584,
             '2018-01-25': 29424, '2018-01-22': 29230, '2018-01-18': 29055, '2018-01-15': 29054, '2018-01-11': 29053,
             '2018-01-08': 29037, '2018-01-04': 29030, '2018-01-01': 28926, '2017-12-28': 27979, '2017-12-27': 27980,
             '2017-12-25': 29381, '2017-12-21': 29429, '2017-12-18': 29382, '2017-12-14': 29440, '2017-12-12': 27140,
             '2017-12-11': 29444, '2017-12-08': 27132, '2017-12-06': 29498, '2017-12-04': 29499, '2017-12-03': 27135,
             '2017-12-02': 26945, '2017-11-30': 29500, '2017-11-27': 29502, '2017-11-23': 29503, '2017-11-20': 29617,
             '2017-11-16': 29658, '2017-11-13': 29679, '2017-11-09': 29681, '2017-11-06': 29682, '2017-11-02': 29684,
             '2017-10-30': 29685, '2017-10-26': 29728, '2017-10-23': 29731, '2017-10-19': 29735, '2017-10-16': 29738,
             '2017-10-12': 29746, '2017-10-02': 29858, '2017-09-28': 29857, '2017-09-25': 30144, '2017-09-14': 31053,
             '2017-09-11': 31458, '2017-09-07': 31818, '2017-09-04': 38428, '2017-08-31': 38436, '2017-08-28': 38435,
             '2017-08-24': 39736, '2017-08-21': 39742, '2017-08-17': 39749, '2017-08-14': 39752, '2017-08-10': 39754,
             '2017-08-07': 39755, '2017-08-03': 40644, '2017-07-31': 40643, '2017-07-27': 40642, '2017-07-24': 40933,
             '2017-07-20': 40934, '2017-07-17': 40935, '2017-07-13': 40936, '2017-07-10': 40980, '2017-07-06': 40990,
             '2017-07-03': 40998, '2017-06-29': 41000, '2017-06-26': 41282, '2017-06-22': 41285, '2017-06-19': 41337,
             '2017-06-15': 41340, '2017-06-08': 42058, '2017-06-01': 42183, '2017-05-29': 42192, '2017-05-25': 42198,
             '2017-05-22': 42202, '2017-05-18': 42205, '2017-05-15': 42206, '2017-05-11': 42207, '2017-05-08': 42210,
             '2017-05-04': 42211, '2017-05-01': 42212, '2017-04-27': 42266, '2017-04-24': 42267, '2017-04-20': 42274,
             '2017-04-17': 42322, '2017-04-13': 42327, '2017-04-10': 42329, '2017-04-06': 42471, '2017-04-03': 42470,
             '2017-03-30': 42474, '2017-03-27': 42531, '2017-03-23': 42535, '2017-03-20': 42538, '2017-03-16': 42540,
             '2017-03-13': 42597, '2017-03-09': 42596, '2017-03-06': 42599, '2017-03-02': 42601, '2017-02-27': 42605,
             '2017-02-23': 42610, '2017-02-20': 42614, '2017-02-16': 42613, '2017-02-13': 42612, '2017-02-09': 42611,
             '2017-01-26': 42668, '2017-01-23': 42671, '2017-01-20': 42675, '2017-01-16': 42679, '2017-01-12': 42681,
             '2017-01-09': 42682, '2017-01-05': 42683, '2017-01-02': 42684, '2016-12-29': 45930, '2016-12-26': 46741,
             '2016-12-22': 46748, '2016-12-19': 46752, '2016-12-15': 46754, '2016-12-12': 46758, '2016-12-08': 46763,
             '2016-12-05': 46764, '2016-12-01': 46765, '2016-11-28': 46767, '2016-11-24': 46819, '2016-11-21': 46820,
             '2016-11-17': 46826, '2016-11-14': 46827, '2016-11-10': 46829, '2016-11-07': 47911, '2016-11-03': 46877,
             '2016-10-31': 47917, '2016-10-27': 48043, '2016-10-24': 48042, '2016-10-20': 48329, '2016-10-17': 48333,
             '2016-10-13': 48517, '2016-10-10': 48523, '2016-09-29': 48688, '2016-09-26': 48689, '2016-09-22': 48690,
             '2016-09-19': 48691, '2016-09-15': 48758, '2016-09-12': 48759, '2016-09-08': 48762, '2016-09-05': 48763,
             '2016-08-25': 49025, '2016-08-22': 49024, '2016-08-18': 49023, '2016-08-15': 49027, '2016-08-11': 49034,
             '2016-08-08': 49228, '2016-08-04': 49231, '2016-08-01': 49355, '2016-07-28': 49439, '2016-07-25': 49730,
             '2016-07-21': 50362, '2016-07-18': 50369, '2016-07-14': 50373, '2016-07-11': 51090, '2016-07-07': 51098,
             '2016-07-04': 51103, '2016-06-30': 51107, '2016-06-27': 51110, '2016-06-23': 51181, '2016-06-20': 51320,
             '2016-06-16': 51336, '2016-06-09': 51335, '2016-06-06': 51337, '2016-06-02': 51338}


def get_date_url(paper_time):
    value = date_dict.get(paper_time)
    if value:
        return f'https://www.xyshjj.cn/newsepaper/10193_{value}_zgxyjjb.html'
    else:
        return False


# print(get_date_url('2016-06-02'))


def get_chinaxianyujingji_paper(paper_time, queue_id, webpage_id):

    url = get_date_url(paper_time)
    tag = False
    if not url:
        if paper_time > '2024-11-04':
            url = "https://www.xyshjj.cn/newsepaper/10193_155394_1747941_zgxyjjb.html"
            tag = True
        else:
            raise Exception(f'该日期没有报纸')

    page = ChromiumPage(co)
    tab = page.new_tab()
    tab.get(url)
    if tag:
        tab.ele("xpath=//ul[@class='navPaper']/li[4]/div").click(by_js=True)
    flag = True
    count = 0
    while flag:
        bm_url = tab.url
        count += 1
        bm_name = f"第{count}版"
        elements = tab.eles("xpath=//ul[@class='catalogList']/li")
        for element in elements:
            article_name = element.text
            # print(article_name)
            element.click(by_js=True)
            article_url = tab.url
            try:
                text_ele = tab.ele("xpath=//div[@class='articleContent'] | //div[@class='articleContent']")
                content = text_ele.text
                # print(content)
            except:
                content = ''
            tab.ele("目录").click(by_js=True)
            create_time = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            create_date = datetime.now().strftime('%Y-%m-%d')
            # 上传到测试数据库
            conn_test = mysql.connector.connect(
                host="rm-bp1t2339v742zh9165o.mysql.rds.aliyuncs.com",
                user="col2024",
                password="Bm_a12a06",
                database="col",
            )
            cursor_test = conn_test.cursor()
            # print(bm_name, bm_url, article_name, article_url, content)
            if judging_criteria(article_name, content):
                bm_pdf = None
                # 将报纸url上传
                up_pdf = None

                # 上传到报纸的图片或PDF
                insert_sql = "INSERT INTO col_paper_page (day, paper, name, original_pdf, page_url, pdf_url, create_time, from_queue, create_date, webpage_id) VALUES (%s,%s,%s, %s,%s, %s, %s, %s, %s, %s)"

                cursor_test.execute(insert_sql,
                                    (paper_time, paper, bm_name, bm_pdf, bm_url, up_pdf, create_time, queue_id,
                                     create_date, webpage_id))
                conn_test.commit()

            if judging_criteria(article_name, content):
                # if 1:

                # print(content)
                # return

                # 上传到报纸的内容
                insert_sql = "INSERT INTO col_paper_notice (page_url, day, paper, title, content, content_url,  create_time, from_queue, create_date, webpage_id) VALUES (%s,%s,%s,%s, %s, %s, %s, %s, %s, %s)"

                cursor_test.execute(insert_sql,
                                    (bm_url, paper_time, paper, article_name, content, article_url, create_time,
                                     queue_id,
                                     create_date, webpage_id))
                conn_test.commit()

            cursor_test.close()
            conn_test.close()
        element = tab.ele("xpath=//ul[@class='navPaper']/li[7]/div").click()
        if count == 8:
            flag = False

    # tab.wait(3)
    tab.close()
    # page.close()
    success_data = {
        'id': queue_id,
        'description': '数据获取成功',
    }
    paper_queue_success(success_data)



# get_chinaxianyujingji_paper('2024-12-09', '11', '222')
